<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SATNav for Math (Canvas)</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --primary-text-color: #e4e4e4;
            --secondary-text-color: #b1b1c1;

            --algebra-color: #ff6384;
            --advanced-math-color: #36a2eb;
            --problem-solving-color: #ffcd56;
            --geometry-color: #4bc0c0;
            --sub-topic-color: #888888;
        }
        
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            overflow: hidden; /* Prevent body scrolling */
        }

        .top-bar {
            background-color: rgba(0, 0, 0, 0.4);
            color: var(--primary-text-color);
            text-align: center;
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
        }

        .branding {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            color: var(--secondary-text-color);
            font-size: 0.8rem;
            z-index: 100;
        }
        
        #concept-map-canvas {
            width: 100vw;
            height: 100vh;
            display: block;
            cursor: grab;
        }

        #info-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100vh;
            background-color: #2b2b41;
            padding: 2rem;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 200;
            overflow-y: auto;
        }

        .info-panel-visible {
            transform: translateX(0);
        }

        #close-panel {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            #info-panel {
                width: 100vw;
            }
        }
    </style>
</head>
<body>
    <header class="top-bar">
        <h1>SATNav for Math Prototype</h1>
    </header>

    <main>
        <canvas id="concept-map-canvas"></canvas>
    </main>

    <div id="info-panel" class="info-panel-hidden">
        <button id="close-panel">X</button>
        <h2 id="panel-title"></h2>
        <p id="panel-description"></p>
        <div id="panel-examples"></div>
    </div>

    <footer class="branding">
        <span>IBMC.pk</span>
    </footer>

    <script>
        window.onload = function () {
            const canvas = document.getElementById('concept-map-canvas');
            const ctx = canvas.getContext('2d');
            const infoPanel = document.getElementById('info-panel');
            const closeButton = document.getElementById('close-panel');

            // Data model for the nodes, including sub-topics and parent references
            const nodes = {
                'sat-math-hub': { label: 'SAT Math', x: 0, y: 0, color: '#6a6a8a', radius: 100, originalRadius: 100, isVisible: true },
                'algebra': { label: 'Algebra & Linear Equations', x: -300, y: -250, color: 'var(--algebra-color)', radius: 80, originalRadius: 80, isVisible: true, isExpanded: false, details: "Focuses on creating and solving linear equations and inequalities, systems of equations, and interpreting linear function graphs.", examples: ["Example: Solve for x in $3(x+2)=15$.", "Example: If $5x - 3 = 12$, what is the value of $10x$?"] },
                'advanced-math': { label: 'Advanced Math', x: 300, y: -250, color: 'var(--advanced-math-color)', radius: 80, originalRadius: 80, isVisible: true, isExpanded: false, details: "Covers quadratic equations, exponential functions, and polynomials.", examples: ["Example: Find the vertex of $y = (x-3)^2 + 4$.", "Example: If $2^x = 16$, what is the value of $x$?"] },
                'problem-solving': { label: 'Problem Solving & Data Analysis', x: -300, y: 250, color: 'var(--problem-solving-color)', radius: 80, originalRadius: 80, isVisible: true, isExpanded: false, details: "Tests your ability to apply math to real-world scenarios. Topics include rates, ratios, percentages, statistics, and probability.", examples: ["Example: A car travels 180 miles in 3 hours. How many miles in 5 hours?", "Example: The average of a set of 5 numbers is 10. If a new number, 16, is added to the set, what is the new average?"] },
                'geometry': { label: 'Geometry & Trigonometry', x: 300, y: 250, color: 'var(--geometry-color)', radius: 80, originalRadius: 80, isVisible: true, isExpanded: false, details: "Focuses on area, volume, coordinate geometry, and basic trigonometric relationships.", examples: ["Example: The area of a circle is 25Ï€. What is its circumference?", "Example: In a right triangle, one leg is 5 and the hypotenuse is 13. What is the length of the other leg?"] },

                // Sub-categories, initially hidden
                'linear-equations': { label: 'Linear Equations', parent: 'algebra', x: -450, y: -400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "These problems require you to set up and solve linear equations and inequalities. Key skills include isolating variables and simplifying expressions.", examples: ["Example: The sum of three consecutive integers is 36. What is the smallest integer?", "Example: Solve for $x$ in the inequality $4x + 7 < 15$."] },
                'systems': { label: 'Systems of Equations', parent: 'algebra', x: -150, y: -400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "This topic focuses on finding a single solution that satisfies two or more linear equations. Common methods include substitution and elimination.", examples: ["Example: Solve the system of equations: $x + y = 7$ and $2x - y = 5$.", "Example: A vendor sells hot dogs for \$2 each and sodas for \$1.50 each. If a customer buys 10 items for a total of \$18, how many hot dogs did they buy?"] },
                'quadratic-functions': { label: 'Quadratic Functions', parent: 'advanced-math', x: 150, y: -400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "These problems involve parabolas and their properties, including finding roots, vertex, and the axis of symmetry. The quadratic formula is often useful here.", examples: ["Example: What is the sum of the roots of the quadratic equation $2x^2 + 8x - 10 = 0$?", "Example: The graph of $y = (x+2)^2 - 3$ has its vertex at what coordinates?"] },
                'exponential-functions': { label: 'Exponential Functions', parent: 'advanced-math', x: 450, y: -400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "Focuses on growth and decay models. Key skills include understanding half-life and compound interest.", examples: ["Example: A population of bacteria doubles every hour. If the initial population is 50, what is the population after 4 hours?", "Example: The value of a car depreciates by 15% each year. If the car was bought for \$20,000, what is its value after 2 years?"] },
                'statistics': { label: 'Statistics', parent: 'problem-solving', x: -450, y: 400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "This section tests your knowledge of mean, median, mode, and standard deviation. Problems often involve interpreting data from charts and tables.", examples: ["Example: The ages of 5 students are 15, 16, 17, 18, and 19. What is the median age?", "Example: A school conducted a survey on 100 students' favorite subjects. If 30 students chose math, what is the probability that a randomly selected student chose math?"] },
                'probability': { label: 'Probability', parent: 'problem-solving', x: -150, y: 400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "Problems in this area deal with the likelihood of events occurring. Understanding independent and dependent events is crucial.", examples: ["Example: A fair coin is flipped three times. What is the probability of getting exactly two heads?", "Example: A bag contains 3 red balls and 5 blue balls. If you draw two balls without replacement, what is the probability that both are blue?"] },
                'right-triangles': { label: 'Right Triangles', parent: 'geometry', x: 450, y: 400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "This topic includes the Pythagorean theorem and basic trigonometry (SOH-CAH-TOA). Many problems involve finding missing side lengths or angle measures.", examples: ["Example: In a right triangle, the two legs are 6 and 8. What is the length of the hypotenuse?", "Example: If $\sin(x) = \frac{3}{5}$ in a right triangle, what is the value of $\cos(x)$?"] },
                'circles': { label: 'Circles', parent: 'geometry', x: 150, y: 400, color: 'var(--sub-topic-color)', radius: 50, originalRadius: 50, isVisible: false, details: "Circle problems on the SAT cover area, circumference, arcs, sectors, and equations of a circle.", examples: ["Example: The equation of a circle is $(x-3)^2 + (y+4)^2 = 25$. What is the center and radius of the circle?", "Example: A circle has a radius of 6. What is the area of a sector with a central angle of $60^\circ$?"] }
            };

            let panX = 0;
            let panY = 0;
            let scale = 1.0;
            let isPanning = false;
            let startX = 0, startY = 0;

            // --- Canvas Setup and Drawing ---

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            function animate() {
                // Update animation state
                for (const key in nodes) {
                    const node = nodes[key];
                    if (node.isVisible) {
                        // Simple pulsating effect
                        node.radius = node.originalRadius + Math.sin(Date.now() / 500) * 5;
                    }
                }
                
                draw();
                requestAnimationFrame(animate);
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                
                // Apply pan and zoom transformations
                ctx.translate(canvas.width / 2 + panX, canvas.height / 2 + panY);
                ctx.scale(scale, scale);

                // Draw lines and connectors first, only if parent and child are visible
                drawConnectors();
                
                // Draw all visible nodes on top
                for (const key in nodes) {
                    const node = nodes[key];
                    if (node.isVisible) {
                        drawNode(node);
                    }
                }

                ctx.restore();
            }

            function drawConnectors() {
                for (const key in nodes) {
                    const node = nodes[key];
                    if (node.parent && node.isVisible) {
                        const parentNode = nodes[node.parent];
                         // Draw curved line from parent to current node
                        ctx.beginPath();
                        ctx.moveTo(parentNode.x, parentNode.y);
                        // Use a quadratic curve for a smooth, organic look
                        ctx.quadraticCurveTo(
                            (parentNode.x + node.x) / 2, // Control point x
                            (parentNode.y + node.y) / 2, // Control point y
                            node.x, node.y
                        );
                        ctx.strokeStyle = '#555';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                    }
                }
            }
            
            function drawNode(node) {
                ctx.save();
                ctx.translate(node.x, node.y);

                // Draw the circle
                ctx.beginPath();
                ctx.arc(0, 0, node.radius, 0, 2 * Math.PI);
                ctx.fillStyle = node.color;
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 10;
                ctx.fill();

                // Draw the text
                ctx.shadowBlur = 0; // Disable shadow for text
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const maxTextWidth = node.radius * 1.8;
                const lineHeight = 20;
                const words = node.label.split(' ');
                let line = '';
                let lines = [];
                
                for(let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + ' ';
                    const metrics = ctx.measureText(testLine);
                    if (metrics.width > maxTextWidth && n > 0) {
                        lines.push(line);
                        line = words[n] + ' ';
                    } else {
                        line = testLine;
                    }
                }
                lines.push(line);
                
                ctx.font = '16px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                if (node.label === 'SAT Math') {
                    ctx.font = 'bold 24px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                }
                let startY = -((lines.length - 1) * lineHeight) / 2;
                lines.forEach((l, i) => {
                    ctx.fillText(l, 0, startY + i * lineHeight);
                });
                ctx.restore();
            }

            // --- Event Listeners for Pan, Zoom, and Clicks ---

            canvas.addEventListener('mousedown', (e) => {
                isPanning = true;
                startX = e.clientX - panX;
                startY = e.clientY - panY;
                canvas.style.cursor = 'grabbing';
            });

            window.addEventListener('mousemove', (e) => {
                if (!isPanning) return;
                panX = e.clientX - startX;
                panY = e.clientY - startY;
            });

            window.addEventListener('mouseup', () => {
                isPanning = false;
                canvas.style.cursor = 'grab';
            });

            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomFactor = 0.1;
                const delta = e.deltaY > 0 ? -1 : 1;
                
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left - canvas.width / 2;
                const mouseY = e.clientY - rect.top - canvas.height / 2;

                const newScale = Math.max(0.3, Math.min(2.5, scale + delta * zoomFactor));
                
                // Adjust pan to keep the point under the cursor in the same location
                panX -= mouseX * (newScale - scale) / newScale;
                panY -= mouseY * (newScale - scale) / newScale;
                scale = newScale;
            });

            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                const adjustedMouseX = (mouseX - canvas.width / 2 - panX) / scale;
                const adjustedMouseY = (mouseY - canvas.height / 2 - panY) / scale;

                for (const key in nodes) {
                    const node = nodes[key];
                    const distance = Math.sqrt(
                        (adjustedMouseX - node.x) ** 2 +
                        (adjustedMouseY - node.y) ** 2
                    );

                    if (distance < node.radius && node.isVisible) {
                        populateInfoPanel(node);
                        // Toggle sub-nodes for main categories
                        if (['algebra', 'advanced-math', 'problem-solving', 'geometry'].includes(key)) {
                            node.isExpanded = !node.isExpanded;
                            for (const subKey in nodes) {
                                const subNode = nodes[subKey];
                                if (subNode.parent === key) {
                                    subNode.isVisible = node.isExpanded;
                                }
                            }
                        }
                        break;
                    }
                }
            });

            function populateInfoPanel(node) {
                const title = document.getElementById('panel-title');
                const description = document.getElementById('panel-description');
                const examples = document.getElementById('panel-examples');

                title.textContent = node.label;
                description.textContent = node.details || 'No description available for this topic.';
                examples.innerHTML = '';
                if (node.examples) {
                    node.examples.forEach(example => {
                        const p = document.createElement('p');
                        p.textContent = example;
                        examples.appendChild(p);
                    });
                }

                infoPanel.classList.remove('info-panel-hidden');
                infoPanel.classList.add('info-panel-visible');
            }

            closeButton.addEventListener('click', () => {
                infoPanel.classList.remove('info-panel-visible');
                infoPanel.classList.add('info-panel-hidden');
            });

            animate();
        };
    </script>
</body>
</html>
